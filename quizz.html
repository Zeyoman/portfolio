<!DOCTYPE html>
<html lang="fr">
<head>
    <link rel="stylesheet" href="./static/css/quizz.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <meta charset="UTF-8">
    <title>Quiz</title>
</head>
<body class="colorScheme">
    <section id="container-quizz" class="colorScheme">
        <div id="container-section-quizz" class="colorScheme">
            <div id="selection-titre-quizz" class="colorScheme">
                <h1 id="titre-quizz">Quiz d'apprentissage de Kurde</h1>
            </div>
            <div id="container-selection-difficulty" class="colorScheme">
                <label id="label-select-difficulty-quizz" for="difficulty" class="colorScheme">Choisissez une difficultée :</label>
                <select id="difficulty" class="button-style-quizz colorScheme">
                    <option value="easy">Facile</option>
                    <option value="medium">Moyen</option>
                    <option value="hard">Difficile</option>
                </select>
            </div>
            <div id="container-button-start-quizz" class="colorScheme">
                <button id="button-start-quizz" class="button-style-quizz colorScheme" onclick="startQuiz()">Commencer le quiz</button>
            </div>
        </div>
        <div id="quiz" class="colorScheme" style="display: none;"></div>
        <div id="result" class="colorScheme" style="display: none;"></div>
    </section>

    <script>
        let questions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let wrongAnswers = [];
        let pourcentage = 0;

        async function fetchQuestions() {
            const response = await fetch('./static/js/questions.json');
            const data = await response.json();
            return data.questions;
        }

        function getRandomQuestions(questions, numQuestions) {
            const shuffled = questions.sort(() => 0.5 - Math.random());
            return shuffled.slice(0, numQuestions);
        }

        function getDifficultyNumber(difficulty){
            if(difficulty == "easy"){
                console.log("facile")
                return 10
            } else if(difficulty == "medium"){
                console.log("moyen")
                return 10
            } else if(difficulty == "hard"){
                console.log("dur")
                return 20
            }
        }

        async function startQuiz() {
            const difficulty = document.getElementById('difficulty').value;
            const allQuestions = await fetchQuestions();
            questions = allQuestions.filter(q => q.difficulty === difficulty);
            questions = getRandomQuestions(questions, getDifficultyNumber(difficulty));
            currentQuestionIndex = 0;
            score = 0;
            wrongAnswers = [];
            document.getElementById('container-section-quizz').style.display = 'none';
            document.getElementById('quiz').style.display = 'flex';
            document.getElementById('result').style.display = 'none';
            document.getElementById('quiz').innerHTML = '';
            document.getElementById('result').innerHTML = '';
            showQuestion();
        }

        function showQuestion() {
            if (currentQuestionIndex < questions.length) {
                const question = questions[currentQuestionIndex];
                const quizDiv = document.getElementById('quiz');
                
                quizDiv.innerHTML = `
                    <div class="index-quiz colorScheme">
                        <p>${currentQuestionIndex} / ${questions.length}</p>
                    </div>
                    <div class="title-quiz colorScheme">
                        <p>${question.question}</p>
                    </div>
                    <div class="container-button-quiz colorScheme">
                        ${question.choices.map((choice, index) => `
                            <button class="button-quiz button-style-quizz colorScheme" onclick="submitAnswer('${choice}')">${choice}</button>
                        `).join('')}
                    </div>
                `;
            } else {
                showResult();
            }
        }

        function submitAnswer(answer) {
            const question = questions[currentQuestionIndex];
            if (answer === question.answer) {
                score++;
            } else {
                wrongAnswers.push({
                    question: question.question,
                    correctAnswer: question.answer,
                    yourAnswer: answer
                });
            }
            currentQuestionIndex++;
            showQuestion();
        }

        function showResult() {
            const resultDiv = document.getElementById('result');
            pourcentage = (100 * score) / questions.length
            document.getElementById('container-section-quizz').style.display = 'flex';
            document.getElementById('quiz').style.display = 'none';
            document.getElementById('result').style.display = 'flex';
            if(wrongAnswers[0] != undefined){
                resultDiv.innerHTML = `
                <span id="button-close-modal-recap" class="button-close-modal material-symbols-outlined colorScheme" onclick="closeModal(result)" >close</span>
                <div id="result-container" class="colorScheme" >
                    <div id="container-title-recap" class="colorScheme" >
                        <h2 class="colorScheme" >Récapitulatif</h2>
                    </div>
                    <div id="container-score-bloc" class="colorScheme" >
                        <p class="colorScheme" >Score: ${score} / ${questions.length} ( ${pourcentage}% )</p>
                    </div> 
                    <div id="container-mauvaise-reponse" class="colorScheme" > 
                        <div id="container-title-mauvaise-reponse" class="colorScheme" >
                            <h3 class="colorScheme" >Mauvaises réponses :</h3>
                        </div>
                        <div id="container-liste-mauvaise-reponse" class="colorScheme" >
                            <ul class="colorScheme" >
                                ${wrongAnswers.map(wrong => `
                                    <li class="colorScheme" >${wrong.question} <br>
                                    Votre réponse: ${wrong.yourAnswer} <br>
                                    Réponse correcte: ${wrong.correctAnswer}</li>
                                `).join('')}
                            </ul>
                        </div>
                    </div>
                </div>
            `;
            } else{
                resultDiv.innerHTML = `
                <span id="button-close-modal-recap" class="button-close-modal material-symbols-outlined colorScheme" onclick="closeModal(result)" >close</span>
                <div id="result-container" class="colorScheme" >
                    <div id="container-title-recap" class="colorScheme" >
                        <h2 class="colorScheme" >Récapitulatif</h2>
                    </div>
                    <div id="container-score-bloc" class="colorScheme" >
                        <p class="colorScheme" >Score: ${score} / ${questions.length} ( ${pourcentage}% )</p>
                    </div>
                </div>
            `;
            }
        }

        function closeModal(idModal){
            idModal.style.display = "none"
        }

        document.addEventListener('DOMContentLoaded',(event) => {

        })
    </script>
</body>
</html>
